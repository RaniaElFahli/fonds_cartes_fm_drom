library(dplyr) ; library(tidyverse)
library(sf); library(ggplot2)
# charger les shapefiles & mettre projection Lambert 93
epci_fonds <- st_read("C:/Users/Rania El Fahli/Downloads/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2022-04-15/ADECOG_3-1_SHP_WGS84G_FRA/EPCI.shp")
mayotte <- st_read("C://Users//Rania El Fahli//Documents//mayotte.shp")
epci_fonds <- sf::st_transform(epci_fonds, crs = 2154)
mayotte <- sf::st_transform(mayotte, crs = 2154)
# récupérer codes géo 22 des EPCI de chaque DROM
source("C:/Users/Rania El Fahli/Documents/Atlas/Cartes/Scripts/codes_epci_dom.R")
# séparer les fonds de cartes
fonds_separes <- function(table_sf, code_geo, code_filtre) {
france_m <- table_sf %>%
dplyr::filter(!{{code_geo}} %in% get(paste0(code_filtre, "_dom")))
print(paste("Exclure:", paste0(code_filtre, "_dom")))
print(head(france_m))
guadeloupe <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_guad")))
print(paste("Inclure Guadeloupe:", paste0(code_filtre, "_guad")))
print(head(guadeloupe))
reunion <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_reun")))
print(paste("Inclure Reunion:", paste0(code_filtre, "_reun")))
print(head(reunion))
martinique <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_mart")))
print(paste("Inclure Martinique:", paste0(code_filtre, "_mart")))
print(head(martinique))
guyane <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_guy")))
print(paste("Inclure Guyane:", paste0(code_filtre, "_guy")))
print(head(guyane))
return(list(france_m = france_m, guadeloupe = guadeloupe, reunion = reunion, martinique = martinique, guyane = guyane))
}
fonds_separes_epci <- fonds_separes(
table_sf = epci_fonds,
code_geo = CODE_SIREN,
code_filtre = "epci"
)
# calcul des bbox :
install.packages("qgisprocess")
qgisprocess::qgis_providers()
qgisprocess::qgis_providers()
qgisprocess::qgis_algorithms()
qgisprocess::qgis_search_algorithms("affine")
c <- qgisprocess::qgis_search_algorithms("affine")
View(c)
library(dplyr) ; library(tidyverse)
library(sf); library(ggplot2)
# charger les shapefiles & mettre projection Lambert 93
epci_fonds <- st_read("C:/Users/Rania El Fahli/Downloads/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2022-04-15/ADECOG_3-1_SHP_WGS84G_FRA/EPCI.shp")
mayotte <- st_read("C://Users//Rania El Fahli//Documents//mayotte.shp")
epci_fonds <- sf::st_transform(epci_fonds, crs = 2154)
qgis_get_argument_specs("grass:v.affine") |>
select(name, description) |>
slice_head(n = 4)
qgisprocess::qgis_get_argument_specs("grass:v.affine") |>
select(name, description) |>
slice_head(n = 4)
rlang::last_trace()
library(qgisprocess)
library(qgisprocess)
qgis_get_argument_specs("native::affine")
qgis_search_algorithms("affine")
View(c)
qgis_get_argument_specs("native::affinetransform")
qgis_get_argument_specs("native:affinetransform")
guad = qgis_run_algorithm("native:affinetransform",
input = fonds_separes_epci[["guadeloupe"]])
guad = qgis_run_algorithm("native:affinetransform",
INPUT = fonds_separes_epci[["guadeloupe"]], )
View(guad)
guad[[".args"]][["OUTPUT"]]
guad[[".args"]][["INPUT"]]
View(epci_fonds)
dep <- st_read("C:/Users/Rania El Fahli/Downloads/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2022-04-15/ADECOG_3-1_SHP_WGS84G_FRA/DEPARTEMENT.shp")
View(dep)
View(dep[[6]][[57]])
bbox_drom_fm <- lapply(fonds_separes_epci, function(x) {
assign(paste0(names(x)), x |> sf::st_bbox(), envir = .GlobalEnv)
})
# Calcul des paramètres dx et dy de translation :
dx_guadeloupe <- bbox_drom_fm[["france_m"]]$xmax + 100000 -  bbox_drom_fm[["guadeloupe"]]$xmin
dy_guadeloupe <- bbox_drom_fm[["france_m"]]$ymin - 100000 - bbox_drom_fm[["guadeloupe"]]$ymin
g <- fonds_separes_epci[["guadeloupe"]]
test = st_geometry(g) + c(dx_guadeloupe , dy_guadeloupe)
test_2 = sf::st_set_geometry(g, test)
test_2 <- st_set_crs(test_2, 2154)
tab_22 <- COGugaison::table_supracom_2022
epci_corse <- tab_22 |>
dplyr::filter(REG == "94") |>
select(c(EPCI)) |>
distinct(EPCI)
epci_corse <- epci_corse$EPCI
epci_fm_sc <- fonds_separes_epci[["france_m"]] |>
dplyr::filter(!CODE_SIREN %in% epci_corse)
# le xmax et ymin de france_m est par rapport à la corse, on essaye sans la CORSE
bbox_fm_sc <- sf::st_bbox(epci_fm_sc)
dx_guadeloupe <- (bbox_fm_sc$xmin-  bbox_drom_fm[["guadeloupe"]]$xmin)
dy_guadeloupe <- (bbox_fm_sc$ymax- bbox_drom_fm[["guadeloupe"]]$ymax) - 500000
g <- fonds_separes_epci[["guadeloupe"]]
test = st_geometry(g)
test_2 = sf::st_set_geometry(g, test)
guadeloupe <- st_set_crs(test_2, 2154)
mapview::mapview(g)
mapview::mapview(guadeloupe)
guadeloupe <- st_set_crs(test_2, 2154)
mapview::mapview(guadeloupe)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 95000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 500000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
test_2 <- st_set_crs(test_2, 2154)
mapview::mapview(test_2)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 95000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 800000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
test_2 <- st_set_crs(test_2, 2154)
mapview::mapview(test_2)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 95000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 400000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
test_2 <- st_set_crs(test_2, 2154)
mapview::mapview(test_2)
dx_guadeloupe <- (bbox_fm_sc$xmin-  bbox_drom_fm[["guadeloupe"]]$xmin) - 95000
dy_guadeloupe <- (bbox_fm_sc$ymax- bbox_drom_fm[["guadeloupe"]]$ymax) - 500000
g <- fonds_separes_epci[["guadeloupe"]]
test = st_geometry(g)
test_2 = sf::st_set_geometry(g, test)
guadeloupe <- st_set_crs(test_2, 2154)
mapview::mapview(guadeloupe)
dx_guadeloupe <- (bbox_fm_sc$xmin-  bbox_drom_fm[["guadeloupe"]]$xmin) - 95000
dy_guadeloupe <- (bbox_fm_sc$ymax- bbox_drom_fm[["guadeloupe"]]$ymax) - 500000
g <- fonds_separes_epci[["guadeloupe"]]
test = st_geometry(g) + c(dx_guadeloupe , dy_guadeloupe)
test_2 = sf::st_set_geometry(g, test)
guadeloupe <- st_set_crs(test_2, 2154)
mapview::mapview(guadeloupe)
plot(st_geometry(g))
martinique <- st_set_crs(test_2, 2154)
test_fm_guad <- rbind(epci_fm_sc, guadeloupe, martinique)
mapview::mapview(test_fm_guad)
martinique <- st_set_crs(test_2, 2154)
test_fm_guad <- rbind(epci_fm_sc, guadeloupe, martinique)
mapview::mapview(test_fm_guad)
mapview::mapview(martinique)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 95000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 400000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
martinique <- st_set_crs(test_2, 2154)
mapview::mapview(martinique)
test_fm_guad <- rbind(epci_fm_sc, guadeloupe, martinique)
mapview::mapview(test_fm_guad)
mapview::mapview(martinique)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 92000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 500000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
martinique <- st_set_crs(test_2, 2154)
mapview::mapview(martinique)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 82000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 500000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
martinique <- st_set_crs(test_2, 2154)
mapview::mapview(martinique)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 42000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 500000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
martinique <- st_set_crs(test_2, 2154)
mapview::mapview(martinique)
dx_martinique <- (bbox_fm_sc$xmin-  bbox_drom_fm[["martinique"]]$xmin) - 42000
dy_martinique <- (bbox_fm_sc$ymax- bbox_drom_fm[["martinique"]]$ymax) - 400000
m <- fonds_separes_epci[["martinique"]]
test = st_geometry(m) + c(dx_martinique , dy_martinique)
test_2 = sf::st_set_geometry(m, test)
martinique <- st_set_crs(test_2, 2154)
mapview::mapview(martinique)
coords <- st_coordinates(g)
View(coords)
epci_fonds <- st_read("C:/Users/Rania El Fahli/Downloads/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG_3-1__SHP_WGS84G_FRA_2022-04-15/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2022-04-15/ADECOG_3-1_SHP_WGS84G_FRA/EPCI.shp")
mayotte <- st_read("C://Users//Rania El Fahli//Documents//mayotte.shp")
# epci_fonds <- sf::st_transform(epci_fonds, crs = 2154)
# mayotte <- sf::st_transform(mayotte, crs = 2154)
# récupérer codes géo 22 des EPCI de chaque DROM
source("C:/Users/Rania El Fahli/Documents/Atlas/Cartes/Scripts/codes_epci_dom.R")
# séparer les fonds de cartes
fonds_separes <- function(table_sf, code_geo, code_filtre) {
france_m <- table_sf %>%
dplyr::filter(!{{code_geo}} %in% get(paste0(code_filtre, "_dom")))
print(paste("Exclure:", paste0(code_filtre, "_dom")))
print(head(france_m))
guadeloupe <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_guad")))
print(paste("Inclure Guadeloupe:", paste0(code_filtre, "_guad")))
print(head(guadeloupe))
reunion <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_reun")))
print(paste("Inclure Reunion:", paste0(code_filtre, "_reun")))
print(head(reunion))
martinique <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_mart")))
print(paste("Inclure Martinique:", paste0(code_filtre, "_mart")))
print(head(martinique))
guyane <- table_sf %>%
dplyr::filter({{code_geo}} %in% get(paste0(code_filtre, "_guy")))
print(paste("Inclure Guyane:", paste0(code_filtre, "_guy")))
print(head(guyane))
return(list(france_m = france_m, guadeloupe = guadeloupe, reunion = reunion, martinique = martinique, guyane = guyane))
}
fonds_separes_epci <- fonds_separes(
table_sf = epci_fonds,
code_geo = CODE_SIREN,
code_filtre = "epci"
)
# calcul des bbox :
bbox_drom_fm <- lapply(fonds_separes_epci, function(x) {
assign(paste0(names(x)), x |> sf::st_bbox(), envir = .GlobalEnv)
})
mapview::mapview(fonds_separes_epci[["guadeloupe"]])
test = st_geometry(fonds_separes_epci[["guadeloupe"]]) + c(6355000,3330000)
test
mayotte
test = st_set_crs("WGS 84")
st_crs(mayotte)
test = st_set_crs(4326)
test = st_set_crs(test, 4326)
mapview::mapview(test)
test
plot(st_geometry(test))
